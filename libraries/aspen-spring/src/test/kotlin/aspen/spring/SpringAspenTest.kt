package aspen.spring

import aspen.spring.examples.SpringApplicationTestExample
import aspen.spring.examples.SpringApplicationTestExampleUsingInit
import io.damo.aspen.metatests.executeRunner
import io.damo.aspen.spring.SpringTestTreeRunner
import org.hamcrest.Matchers.equalTo
import org.junit.Assert.assertThat
import org.junit.Test
import kotlin.reflect.KClass

class SpringAspenTest {

    @Test
    fun testSpringApplicationTestExample() {
        val listener = runSpringTest(SpringApplicationTestExample::class)

        assertThat(listener.tests, equalTo(listOf(
            "GET /hello",
            "GET /world"
        )))

        assertThat(listener.failingTests, equalTo(listOf(
            "GET /world"
        )))
    }

    @Test
    fun testSpringApplicationTestExampleUsingInit() {
        val listener = runSpringTest(SpringApplicationTestExampleUsingInit::class)

        assertThat(listener.tests, equalTo(listOf(
            "GET /hello",
            "GET /world"
        )))

        assertThat(listener.failingTests, equalTo(listOf(
            "GET /world"
        )))
    }
}

fun <T : io.damo.aspen.Test> runSpringTest(kClass: KClass<T>) = executeRunner(SpringTestTreeRunner(kClass.java))
