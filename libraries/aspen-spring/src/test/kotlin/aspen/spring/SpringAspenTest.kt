package aspen.spring

import aspen.spring.examples.SpringApplicationTestExample
import aspen.spring.examples.SpringApplicationTestExampleUsingInit
import io.damo.aspen.TestTree
import io.damo.aspen.metatests.executeRunner
import io.damo.aspen.spring.SpringTestTreeRunner
import org.assertj.core.api.Assertions.assertThat
import org.junit.Test
import kotlin.reflect.KClass

class SpringAspenTest {

    @Test
    fun testSpringApplicationTestExample() {
        val listener = runSpringTest(SpringApplicationTestExample::class)

        assertThat(listener.tests).containsExactly(
            "GET /hello(aspen.spring.examples.SpringApplicationTestExample)",
            "GET /world(aspen.spring.examples.SpringApplicationTestExample)"
        )

        assertThat(listener.failingTests).containsExactly(
            "GET /world(aspen.spring.examples.SpringApplicationTestExample)"
        )
    }

    @Test
    fun testSpringApplicationTestExampleUsingInit() {
        val listener = runSpringTest(SpringApplicationTestExampleUsingInit::class)

        assertThat(listener.tests).containsExactly(
            "GET /hello(aspen.spring.examples.SpringApplicationTestExampleUsingInit)",
            "GET /world(aspen.spring.examples.SpringApplicationTestExampleUsingInit)"
        )

        assertThat(listener.failingTests).containsExactly(
            "GET /world(aspen.spring.examples.SpringApplicationTestExampleUsingInit)"
        )
    }
}

fun <T : TestTree> runSpringTest(kClass: KClass<T>) = executeRunner(SpringTestTreeRunner(kClass.java))
